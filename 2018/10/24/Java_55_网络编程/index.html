<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="JiaojiaoFu"><link rel="alternative" href="/atom.xml" title="姣姣的个人主页" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Chapter 55 网络编程 - 姣姣的个人主页</title><link rel="stylesheet" href="/css/main.css" type="text/css">
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css" type="text/css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="/js/fancybox/jquery.fancybox.min.js" type="text/javascript"></script>
</head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">姣姣的个人主页</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-10-23T16:00:00.000Z">October 24, 2018</time><h1 class="post__title"><a href="/2018/10/24/Java_55_网络编程/">Chapter 55 网络编程</a></h1><div class="post__main echo"><p>网络编程的时代已经结束。讲解的目的是阐述网络操作的过程，这些过程将会直接影响到 JavaEE 的开发。<br><a id="more"></a></p>
<h3 id="网络编程">网络编程</h3>
<p>网络编程的时代已经结束。讲解的目的是阐述网络操作的过程，这些过程将会直接影响到 JavaEE 的开发。</p>
<h4 id="1-_网络编程简介">1. 网络编程简介</h4>
<p>网络编程：进行服务器端与客服端编程的开发操作的实现。<br>实际工作中对网络编程有两种形式：</p>
<ul>
<li>C / S 结构（Client / Server），此类开发需要编写两套程序，一套用于客户端、一套用于服务器。这样的程序开发非常麻烦，因为要维护两套程序的使用。优点是安全性高，因为使用的是自己的连接端口和通信协议。</li>
<li>B / S 结构（Browser / Server），此类开发只需要编写服务器端代码，不再开发单独的客服端代码，用户通过浏览器进行访问。但是安全性不高，因为使用的是公共的 HTTP 协议以及公共的 80 端口。</li>
</ul>
<p>本次要讲解的网络编程是 C / S 程序开发，即要开发两套程序。这样的程序也可以成为 Socket 程序。分为两类：</p>
<ul>
<li>TCP 程序：是采用可靠的连接方式进行传输</li>
<li>UDP 程序：不可靠的连接，属于数据报协议  </li>
</ul>
<p><img src="2018-10-23-18-17-48.png" alt=""></p>
<p>两类程序都不使用了，下面以 TCP 为例讲解</p>
<h4 id="2-_基本实现">2. 基本实现</h4>
<p>想要进行网络编程开发，最为核心的两个类：</p>
<ul>
<li>服务器类：ServerSocket 类，主要工作在服务器端，用于接收用户的请求；</li>
<li>客户端类：Socket 类，每一个连接到服务器的用户都通过 Socket 表示；</li>
</ul>
<p><strong>示例</strong>：定义服务器端 ———— 主要使用 ServerSocket 类</p>
<ul>
<li>构造方法：<code>public ServerSocket(int port)throws IOException</code>设置监听端口</li>
<li>接受客户端连接：<code>public Socket accept()throws IOException</code></li>
<li>取得客户端输出功能，Socket 定义的方法：<code>public getOutputStream()throws IOException</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.PrintStream;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServer</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception{</div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</div><div class="line">        System.out.print(<span class="string">"等待客户端连接……"</span>);</div><div class="line">        Socket client = server.accept();    <span class="comment">// 等待客户端连接</span></div><div class="line">        <span class="comment">// OutputStream 并不适合输出数据，所以使用打印流 PrintStream</span></div><div class="line">        PrintStream out = <span class="keyword">new</span> PrintStream(client.getOutputStream());</div><div class="line">        out.println(<span class="string">"Hello,world！"</span>);</div><div class="line">        out.close();</div><div class="line">        client.close();</div><div class="line">        server.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>服务器必须有端口，9000 左右的端口很少被占用。此时服务器输出 “Hello,world！” 就关闭了服务器操作了，只能处理一次 client 请求。</p>
<p><strong>示例</strong>：编写客户端 ———— Socket</p>
<ul>
<li>构造方法：<code>public Socket(String host,int port) throws Unknown HostException,IOException</code><br>|- host 代表主机的 IP 地址，如果市本级直接访问 localhost(217.0.0.1) 代替IP</li>
<li>得到输入数据：<code>public InputStream getInputStream() throws IOException</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloClient</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args)<span class="keyword">throws</span> Exception{</div><div class="line">        <span class="comment">// 连接服务器</span></div><div class="line">        Socket client = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>,<span class="number">9999</span>);</div><div class="line">        <span class="comment">// 取得客户端的输入数据流对象，表示接收服务器端的输出信息</span></div><div class="line">        Scanner scan = <span class="keyword">new</span> Scanner(client.getInputStream());</div><div class="line">        scan.useDelimiter(<span class="string">"\n"</span>);</div><div class="line">        <span class="keyword">if</span>(scan.hasNext()){</div><div class="line">            System.out.println(<span class="string">"【回应数据】："</span> + scan.next());</div><div class="line">        }</div><div class="line">        scan.close();</div><div class="line">        client.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>客户端现在也只是连接一次服务器，并且接收输入数据，输出后结束操作。</p>
<h3 id="3-_Echo_程序">3. Echo 程序</h3>
<p>在网络编程中， ECHO 是一个经典的程序开发模型，客户端随意输入信息，并将信息发送给服务器，服务器接收后在前面加上一个 “ECHO:” 的标记返回。</p>
<p>设计如下：</p>
<ul>
<li>由于需要采用多次输入的形式，所以不能每次连接后立刻关闭服务器</li>
<li>可以设置一个字符串，当输入了 “byebye”，那么表示结束本次的 ECHO 操作</li>
</ul>
<p><strong>示例</strong>：实现服务器端的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.PrintStream;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServer</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String []args) <span class="keyword">throws</span> Exception{</div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</div><div class="line">        Socket client = server.accept();    <span class="comment">// 连接客户端</span></div><div class="line">        <span class="comment">// 得到客户端输入数据以及向客户端输出数据的对象</span></div><div class="line">        Scanner scan = <span class="keyword">new</span> Scanner(client.getInputStream());</div><div class="line">        PrintStream out = <span class="keyword">new</span> PrintStream(client.getOutputStream());</div><div class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">while</span>(flag){</div><div class="line">            <span class="keyword">if</span>(scan.hasNext()){</div><div class="line">                String str = scan.next().trim();    <span class="comment">// 得到客户端发送的内容</span></div><div class="line"></div><div class="line">                <span class="keyword">if</span>(str.equalsIgnoreCase(<span class="string">"byebye"</span>)){ <span class="comment">// 程序要结束</span></div><div class="line">                    out.println(<span class="string">"拜拜，下次再会！"</span>);</div><div class="line">                    flag = <span class="keyword">false</span>;</div><div class="line">                }<span class="keyword">else</span>{  <span class="comment">// 回应该输入信息</span></div><div class="line">                    out.println(<span class="string">"ECHO : "</span> + str);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        scan.close();</div><div class="line">        out.close();</div><div class="line">        server.close();</div><div class="line">        client.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>示例</strong>：实现客户端代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.PrintStream;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoClient</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception{</div><div class="line">        Socket client = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>,<span class="number">9999</span>);</div><div class="line">        Scanner input = <span class="keyword">new</span> Scanner(System.in); <span class="comment">// 从键盘输入</span></div><div class="line">        Scanner scan = <span class="keyword">new</span> Scanner(client.getInputStream());</div><div class="line">        input.useDelimiter(<span class="string">"\n"</span>);</div><div class="line">        scan.useDelimiter(<span class="string">"\n"</span>);</div><div class="line">        PrintStream out = <span class="keyword">new</span> PrintStream(client.getOutputStream());</div><div class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        <span class="keyword">while</span>(flag){</div><div class="line">            System.out.print(<span class="string">"请输入要发送的数据："</span>);</div><div class="line">            <span class="keyword">if</span>(input.hasNext()){</div><div class="line">                String str = input.next().trim();</div><div class="line">                out.println(str);   <span class="comment">// 发送服务器端数据</span></div><div class="line">                <span class="keyword">if</span>(str.equalsIgnoreCase(<span class="string">"byebye"</span>)){</div><div class="line">                    flag = <span class="keyword">false</span>;   <span class="comment">// 结束循环</span></div><div class="line">                }</div><div class="line">                <span class="keyword">if</span>(scan.hasNext()){</div><div class="line">                    System.out.println(scan.next()); <span class="comment">// 输出回应数据</span></div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        input.close();</div><div class="line">        scan.close();</div><div class="line">        out.close();</div><div class="line">        client.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>此时就实现了一个最简单的服务器端与客户端通讯。此时的程序只能够连接一个客户端，而不能连接其他客户端，因为所有操作都是在主线程上进行的开发，也就是说此时的程序属于单线程的网络应用，实际中不可能如此进行，为了能够让一个服务器端可以同时处理多个客户端的操作，我们使用多线程描述，把每一个连接到服务器的客户都作为一个独立的线程保留。</p>
<p><strong>示例</strong>：修改服务器端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintStream;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line">class EchoThread implements Runnable{</div><div class="line">    <span class="keyword">private</span> Socket client;</div><div class="line">    <span class="keyword">public</span> <span class="title">EchoThread</span>(Socket client) {</div><div class="line">        <span class="keyword">this</span>.client = client;</div><div class="line">    }</div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() {</div><div class="line">        <span class="keyword">try</span> {</div><div class="line">            <span class="comment">// 得到客户端输入数据以及向客户端输出数据的对象</span></div><div class="line">            Scanner scan = <span class="keyword">new</span> Scanner(client.getInputStream());</div><div class="line">            PrintStream out = <span class="keyword">new</span> PrintStream(client.getOutputStream());</div><div class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">while</span>(flag){</div><div class="line">                <span class="keyword">if</span>(scan.hasNext()){</div><div class="line">                    String str = scan.next().trim();    <span class="comment">// 得到客户端发送的内容</span></div><div class="line"></div><div class="line">                    <span class="keyword">if</span>(str.equalsIgnoreCase(<span class="string">"byebye"</span>)){ <span class="comment">// 程序要结束</span></div><div class="line">                        out.println(<span class="string">"拜拜，下次再会！"</span>);</div><div class="line">                        flag = <span class="keyword">false</span>;</div><div class="line">                    }<span class="keyword">else</span>{  <span class="comment">// 回应该输入信息</span></div><div class="line">                        out.println(<span class="string">"ECHO : "</span> + str);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">            scan.close();</div><div class="line">            out.close();</div><div class="line">            client.close();</div><div class="line">        } <span class="keyword">catch</span> (IOException e) {</div><div class="line">            e.printStackTrace();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServer</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String []args) <span class="keyword">throws</span> Exception{</div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</div><div class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">while</span>(flag){</div><div class="line">            Socket client = server.accept();    <span class="comment">// 连接客户端</span></div><div class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> EchoThread(client)).start();</div><div class="line">        }</div><div class="line">        server.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>服务器开发的基础要素：网络支持类、IO、多线程。</p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/Java/">Java</a></li></ul></footer></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 JiaojiaoFu</div></footer><script src="/js/scroller.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>
</body></html>