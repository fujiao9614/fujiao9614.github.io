<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="JiaojiaoFu"><link rel="alternative" href="/atom.xml" title="姣姣的个人主页" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Chapter 57 类集框架 - 姣姣的个人主页</title><link rel="stylesheet" href="/css/main.css" type="text/css">
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css" type="text/css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="/js/fancybox/jquery.fancybox.min.js" type="text/javascript"></script>
</head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">姣姣的个人主页</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-11-04T16:00:00.000Z">November 5, 2018</time><h1 class="post__title"><a href="/2018/11/05/Java_57_Java数据库编程_JDBC/">Chapter 57 类集框架</a></h1><div class="post__main echo"><p>Java 数据库编程，JDBC（Java Database Connective），Java 数据库连接技术。Java 提供的一组与平台无关的数据库的操作标准，是一组接口的组成。<br>数据库属于资源操作，所以所有的数据库操作的最后必须要关闭数据库连接。<br><a id="more"></a></p>
<h3 id="Java_数据库编程（JDBC）">Java 数据库编程（JDBC）</h3>
<h4 id="1-_介绍">1. 介绍</h4>
<p>所有的服务都是固定的流程，属于应用。</p>
<p>JDBC（Java Database Connective），Java 数据库连接技术。Java 提供的一组与平台无关的数据库的操作标准，是一组接口的组成。</p>
<p>数据库属于资源操作，所以所有的数据库操作的最后必须要关闭数据库连接。</p>
<p>四种 Java 数据库的操作方式：  </p>
<ul>
<li>形式一：JDBC-ODBC 桥接技术（100%不用）</li>
<li>形式二：JDBC 直接连接，性能最好，但是支持的 JDBC 版本有限<ul>
<li>直接由不同的数据库生产商提供指定的数据库连接驱动程序（实现了 Java 的数据库操作标准的一群类）</li>
</ul>
</li>
<li>形式三：JDBC 网络连接<ul>
<li>使用专门的数据库的网络连接指令进行指定主机的数据库操作。</li>
</ul>
</li>
<li>形式四：模拟制定数据库的通讯协议自己编写数据库操作</li>
</ul>
<h4 id="2-_连接_mysql_数据库">2. 连接 mysql 数据库</h4>
<h4 id="一、介绍">一、介绍</h4>
<p>在 Java 之中，所有数据库操作的类和接口都保存在 java.sql 包</p>
<ul>
<li>一个类：DriverManager 类；</li>
<li>四个接口：Connection、Statement、ResultSet、PreparedStatement。</li>
</ul>
<p>所有的 JDBC 连接数据库的操作流程都是固定的，按照如下的几步完成：</p>
<ol>
<li>加载数据库的驱动程序（向容器加载）；</li>
<li>进行数据库连接（通过 DriverManager 类完成，Connection 表示连接）；</li>
<li>进行数据的 CRUD（Statement、PreparedStatement，ResultSet）；</li>
<li>关闭数据库操作以及连接（直接关闭连接就可以）</li>
</ol>
<ul>
<li>mysql 程序驱动类：<code>com.mysql.jdbc.Driver</code>。</li>
<li>加载类使用：<code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</code></li>
</ul>
<h4 id="二、连接数据库">二、连接数据库</h4>
<p>如果想要连接数据库需要提供如下的几个信息（前提：数据库服务要打开）：</p>
<ul>
<li>数据库的连接地址：jdbc:mysql:主机名称:端口名称:数据库的SID<ul>
<li>连接本机的 test 数据库：<code>jdbc:mysql://localhost:3306/test</code></li>
</ul>
</li>
<li>数据库的用户名：root</li>
<li>数据库的密码：admin</li>
</ul>
<p>要连接数据库必须依靠 DriverManager 类完成，在此类定义有如下方法：</p>
<ul>
<li>连接数据库：<code>public static Connection getConnection(String url,String user,String password) throws Exception</code></li>
</ul>
<p>在 JDBC 里面，每一个数据库连接都要求使用一个 Connection 对象进行封装，所以只要有一个新的 Connection 就表示要连接一次数据库。</p>
<h4 id="四、关闭数据库">四、关闭数据库</h4>
<p>Connection 接口提供有 close() 方法：<code>public void close() throws SQLException</code> </p>
<p><strong>示例</strong>：mysql 数据的连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.company;</div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.DriverManager;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span> </span>{</div><div class="line">    <span class="comment">// JDBC 驱动名及数据库 URL</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String JDBC_DRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DB_URL = <span class="string">"jdbc:mysql://localhost:3306/test"</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 数据库的用户名与密码，需要根据自己的设置</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String USER = <span class="string">"root"</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String PASS = <span class="string">"admin"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="comment">// 第一步：加载数据库驱动程序，此时不需要实例化，会有容器自己负责管理</span></div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        <span class="comment">// 第二步：连接数据库</span></div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        <span class="comment">// 输出不为空则证明连接成功 com.mysql.jdbc.JDBC4Connection@1de0aca6</span></div><div class="line">        System.out.println(conn);</div><div class="line"></div><div class="line">        <span class="comment">// 第四步： 关闭数据库</span></div><div class="line">        conn.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>在 JDBC 操作中，在驱动数据库连接对象时，采用的是工厂设计模式，而DriverManagement 就是一个工厂类，那么我们客户端调用的时候会完全隐藏具体的实现子类。</p>
<p><img src="Java_57_Java数据库编程_JDBC/2018-10-26-09-29-26.png" alt=""></p>
<p><strong>总结</strong>：</p>
<ol>
<li>以后不管连接何种关系型数据库，都一定要通过 DriverManager 进行数据库连接；</li>
<li>每一个 Connection 接口对象就表示一个数据库连接，程序的最后必须关闭数据连接。</li>
</ol>
<h4 id="3-_Statement接口">3. Statement接口</h4>
<p>mysql 数据库密码：admin</p>
<p>创建表：</p>
<figure class="highlight mysql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> member(</span></div><div class="line">    <span class="keyword">mid</span>     <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">    name    <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</div><div class="line">    birthday <span class="built_in">DATE</span>,</div><div class="line">    age     <span class="built_in">INT</span>,</div><div class="line">    note    <span class="built_in">VARCHAR</span>(<span class="number">100</span>),</div><div class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>(<span class="keyword">mid</span>)</div><div class="line">)<span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div></pre></td></tr></table></figure>

<p>数据的更新操作最关键性的问题是每次更新完成之后都一定回返回影响的数据行数：</p>
<p><strong>范例</strong>：数据增加</p>
<ul>
<li>INSERT INTO 表名称 (列,列,…) VALUES(值,值,…);</li>
</ul>
<p><strong>范例</strong>：数据更新</p>
<ul>
<li>UPDATE 表名称 SET 字段=值，… WHERE 更新条件(s);</li>
</ul>
<p><strong>范例</strong>：数据删除</p>
<ul>
<li>DELETE FROM 表名称 WHERE 删除条件(s);</li>
</ul>
<p>插入、更新、删除：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> member(name,birthday,age,note) <span class="keyword">VALUES</span>(<span class="string">"张三"</span>,<span class="string">'1998-08-16'</span>,<span class="number">20</span>,<span class="string">"一个人"</span>)</span></div><div class="line"></div><div class="line"><span class="keyword">UPDATE</span> member <span class="keyword">SET</span> name=<span class="string">'李四'</span>,birthday=<span class="keyword">NOW</span>(),age=<span class="number">0</span> <span class="keyword">WHERE</span> <span class="keyword">mid</span> <span class="keyword">IN</span>(<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>)</div><div class="line"></div><div class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> member <span class="keyword">WHERE</span> <span class="keyword">mid</span> <span class="keyword">IN</span>(<span class="number">1</span>,<span class="number">5</span>)</div></pre></td></tr></table></figure>

<p>插入中文数据要注意：在数据库 URL 后面添加<code>?characterEncoding=UTF-8</code><br>否则中文会出现乱码。</p>
<p><strong>示例</strong>：插入一条数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.company;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.DriverManager;</div><div class="line"><span class="keyword">import</span> java.sql.Statement;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span> </span>{</div><div class="line">    <span class="comment">// JDBC 驱动名及数据库 URL</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String JDBC_DRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DB_URL = <span class="string">"jdbc:mysql://localhost:3306/test?characterEncoding=UTF-8"</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 数据库的用户名与密码，需要根据自己的设置</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String USER = <span class="string">"root"</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String PASS = <span class="string">"admin"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="comment">// 第一步：加载数据库驱动程序，此时不需要实例化，会有容器自己负责管理</span></div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        <span class="comment">// 第二步：连接数据库</span></div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        <span class="comment">// 第三步：进行数据库的数据操作</span></div><div class="line">        Statement stmt = conn.createStatement();</div><div class="line">        <span class="comment">// 在编写 SQL 语句时，太长了需要换行时，请一定要在前后加上空格</span></div><div class="line">        String sql = <span class="string">" INSERT INTO member(name,birthday,age,note) VALUES "</span> +</div><div class="line">                <span class="string">" ('张三','1998-08-16',20,'一个人') "</span>;</div><div class="line">        <span class="keyword">int</span> len = stmt.executeUpdate(sql);  <span class="comment">// 执行SQL 返回更新的数据行</span></div><div class="line">        System.out.println(<span class="string">"影响的数据行："</span> + len);</div><div class="line">        <span class="comment">// 第四步： 关闭数据库</span></div><div class="line">        stmt.close();   <span class="comment">// 是可选的 无用的</span></div><div class="line">        conn.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p><img src="Java_57_Java数据库编程_JDBC/2018-11-01-17-07-14.png" alt=""></p>
<p>在 ResultSet 接口里面定义了如下的方法：</p>
<ul>
<li>向下移动指针并判断是否有数据行：<code>public boolean next() throws SQLException</code><ul>
<li>移动之后就可以直接取得当前数据行中所有数据列的内容了</li>
</ul>
</li>
<li>取出数据列的内容：getInt()、getDouble()、getString()、getDate()。</li>
</ul>
<p><strong>范例</strong>：实现数据的查询<br>查询时不要写 <code>SELECT *</code>，写出查询的具体内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">String sql = <span class="string">"SELECT mid,name,age,birthday,note FROM member"</span>;</div><div class="line">        ResultSet rs = stmt.executeQuery(sql);</div><div class="line">        <span class="keyword">while</span>(rs.next()){   <span class="comment">// 循环取出返回的每一行数据</span></div><div class="line">            <span class="keyword">int</span> mid = rs.getInt(<span class="string">"mid"</span>);</div><div class="line">            String name = rs.getString(<span class="string">"name"</span>);</div><div class="line">            <span class="keyword">int</span> age = rs.getInt(<span class="string">"age"</span>);</div><div class="line">            Date birthday = rs.getDate(<span class="string">"birthday"</span>);</div><div class="line">            String note = rs.getString(<span class="string">"note"</span>);</div><div class="line">            System.out.println(mid + <span class="string">","</span> + name + <span class="string">","</span> + age + <span class="string">","</span> + birthday + <span class="string">","</span> + note);</div><div class="line">        }</div></pre></td></tr></table></figure>

<p>关于 ResultSet 的使用有以下几点忠告：</p>
<ul>
<li>在使用 getXxx() 取出列数据的时候，强烈建议按照给定的顺序取；</li>
<li>在每一个列的数据只能够按照顺序取一次；</li>
</ul>
<p>以上的代码在 SQL 语句中给出了列名称了，那么可以按照序号取出。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">String sql = <span class="string">"SELECT mid,name,age,birthday,note FROM member"</span>;</div><div class="line">        ResultSet rs = stmt.executeQuery(sql);</div><div class="line">        <span class="keyword">while</span>(rs.next()){   <span class="comment">// 循环取出返回的每一行数据</span></div><div class="line">            <span class="keyword">int</span> mid = rs.getInt(<span class="number">1</span>);</div><div class="line">            String name = rs.getString(<span class="number">2</span>);</div><div class="line">            <span class="keyword">int</span> age = rs.getInt(<span class="number">3</span>);</div><div class="line">            Date birthday = rs.getDate(<span class="number">4</span>);</div><div class="line">            String note = rs.getString(<span class="number">5</span>);</div><div class="line">            System.out.println(mid + <span class="string">","</span> + name + <span class="string">","</span> + age + <span class="string">","</span> + birthday + <span class="string">","</span> + note);</div><div class="line">        }</div></pre></td></tr></table></figure>

<h4 id="4-_PreparedStatement接口">4. PreparedStatement接口</h4>
<p>Statement 如果想要变为灵活的应用，那么就必须采用拼凑字符串的方式完成，可是如果输入的内容有 <code>&#39;</code>，那么整个 SQL 就会出错，也就是说 Statement 的执行模式不适合于处理一些敏感字符。</p>
<p>Statement 执行关键性的问题是在与它需要一个完整的字符串来定义要使用的 SQL 语句，所以这就导致在使用中需要大量的进行 SQL 的拼凑，而 PreparedStatement 与 Statement 不同的地方在与，它执行的是一个完整的具备特殊占位标记的 SQL 语句，并且可以动态的设置所需要的数据。 </p>
<p>想要取得 PreparedStatement 这个子接口的实例化对象，依然需要使用 Connection 接口提供的方法：<br><code>public PreparedStatement prepareStatement(String sql) throws SQLException</code>，里面在执行的时候需要一个 SQL 语句，这个 SQL 一个具备特殊标记的完整 SQL，此时没有内容，当取得了 PreparedStatement 接口对象，需要使用一系列的 setXxx() 方法用于为使用的标记设置具体内容，而后对于执行操作有两个方法支持：</p>
<ul>
<li>更新操作：<code>public int executeUpdate() throws SQLException;</code></li>
<li>查询操作：<code>public ResultSet executeQuery() throws SQLException</code></li>
</ul>
<p>当使用了 PreparedStatement 接口操作时需要注意的是里面的 setDate() 方法，使用的是  java.sql.date 不再是 java.util.Date。</p>
<p>在 java.util.Date 类下有三个子类都是在 java.sql 包中的：</p>
<ul>
<li>java.sql.Date：描述的是日期；</li>
<li>java.sql.Time：描述的是时间；</li>
<li>java.sql.TimeStamp：描述的是时间戳（日期时间）</li>
</ul>
<p>如果要将 java.util.Date 变为 java.sql.Date（Time、Timestamp）只能依靠 long 型：</p>
<ul>
<li>java.util.Date：<code>public long getTime()</code>，可以将 Date 变为 long；</li>
<li>java.sql.Date：<code>public Date(long date)</code>，将 long 变为 sql.Date</li>
<li>sql.Date 可以向上转型为 util.Date，例如：<code>Date birthday = rs.getDate(3);</code></li>
</ul>
<p><strong>示例</strong>：使用 PreparedStatement</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        String name = <span class="string">"Mr'Smith"</span>;</div><div class="line">        <span class="keyword">int</span> age = <span class="number">30</span>;</div><div class="line">        Date birthday = <span class="keyword">new</span> Date();</div><div class="line">        System.out.println(birthday);</div><div class="line">        String note= <span class="string">"外国人"</span>;</div><div class="line">        <span class="comment">// 第一步：加载数据库驱动程序，此时不需要实例化，会有容器自己负责管理</span></div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        <span class="comment">// 第二步：连接数据库</span></div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        <span class="comment">// 第三步：进行数据库的数据操作</span></div><div class="line"></div><div class="line">        <span class="comment">// 在编写 SQL 语句时，太长了需要换行时，请一定要在前后加上空格</span></div><div class="line">        String sql = <span class="string">" INSERT INTO member(name,birthday,age,note) VALUES (?,?,?,?)"</span>;</div><div class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</div><div class="line">        stmt.setString(<span class="number">1</span>,name);</div><div class="line">        stmt.setDate(<span class="number">2</span>,<span class="keyword">new</span> java.sql.Date(birthday.getTime()));</div><div class="line">        stmt.setInt(<span class="number">3</span>,age);</div><div class="line">        stmt.setString(<span class="number">4</span>,note);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> len = stmt.executeUpdate();</div><div class="line">        System.out.println(<span class="string">"影响的行数："</span>+len);</div><div class="line">        </div><div class="line">        <span class="comment">// 第四步： 关闭数据库</span></div><div class="line">        stmt.close();   <span class="comment">// 是可选的 无用的</span></div><div class="line">        conn.close();</div><div class="line">    }</div></pre></td></tr></table></figure>

<p><strong>示例</strong>：查询操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="comment">// 第一步：加载数据库驱动程序，此时不需要实例化，会有容器自己负责管理</span></div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        <span class="comment">// 第二步：连接数据库</span></div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        <span class="comment">// 第三步：进行数据库的数据操作</span></div><div class="line">        <span class="comment">// 在编写 SQL 语句时，太长了需要换行时，请一定要在前后加上空格</span></div><div class="line">        String sql = <span class="string">"SELECT mid,name,birthday,age,note FROM member ORDER BY mid"</span>;</div><div class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</div><div class="line">        ResultSet rs = stmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            <span class="keyword">int</span> mid = rs.getInt(<span class="number">1</span>);</div><div class="line">            String name = rs.getString(<span class="number">2</span>);</div><div class="line">            Date birthday = rs.getDate(<span class="number">3</span>);</div><div class="line">            <span class="keyword">int</span> age = rs.getInt(<span class="number">4</span>);</div><div class="line">            String note = rs.getString(<span class="number">5</span>);</div><div class="line">            System.out.println(mid + <span class="string">","</span> + name + <span class="string">","</span> + birthday + <span class="string">","</span> + age + <span class="string">","</span> + note);</div><div class="line">        }</div><div class="line">        <span class="comment">// 第四步： 关闭数据库</span></div><div class="line">        stmt.close();   <span class="comment">// 是可选的 无用的</span></div><div class="line">        conn.close();</div><div class="line">    }</div></pre></td></tr></table></figure>

<p><strong>示例</strong>：模糊查询操作，设定关键词</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        String keywords = <span class="string">"李"</span>;</div><div class="line">        <span class="comment">// 第一步：加载数据库驱动程序，此时不需要实例化，会有容器自己负责管理</span></div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        <span class="comment">// 第二步：连接数据库</span></div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        <span class="comment">// 第三步：进行数据库的数据操作</span></div><div class="line"></div><div class="line">        <span class="comment">// 在编写 SQL 语句时，太长了需要换行时，请一定要在前后加上空格</span></div><div class="line">        String sql = <span class="string">"SELECT mid,name,birthday,age,note FROM member WHERE name LIKE ?"</span>;</div><div class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</div><div class="line">        stmt.setString(<span class="number">1</span>,<span class="string">"%"</span> + keywords + <span class="string">"%"</span>);</div><div class="line">        ResultSet rs = stmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            <span class="keyword">int</span> mid = rs.getInt(<span class="number">1</span>);</div><div class="line">            String name = rs.getString(<span class="number">2</span>);</div><div class="line">            Date birthday = rs.getDate(<span class="number">3</span>);</div><div class="line">            <span class="keyword">int</span> age = rs.getInt(<span class="number">4</span>);</div><div class="line">            String note = rs.getString(<span class="number">5</span>);</div><div class="line">            System.out.println(mid + <span class="string">","</span> + name + <span class="string">","</span> + birthday + <span class="string">","</span> + age + <span class="string">","</span> + note);</div><div class="line">        }</div><div class="line">        <span class="comment">// 第四步： 关闭数据库</span></div><div class="line">        stmt.close();   <span class="comment">// 是可选的 无用的</span></div><div class="line">        conn.close();</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>如果 keyword = <code>&quot;&quot;</code>;<br>那么匹配全部内容，与直接查询的不同：直接查询不需要判断，直接返回数据。设置条件的查询速度很慢。</p>
<p><strong>示例</strong>：分页显示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 在编写 SQL 语句时，太长了需要换行时，请一定要在前后加上空格</span></div><div class="line"><span class="comment">// LIMIT 第一个参数指定第一个返回记录行的偏移量，第二个参数指定返回记录行的最大数目。</span></div><div class="line">String sql = <span class="string">"SELECT * FROM ("</span> +</div><div class="line">        <span class="string">" SELECT mid,name,birthday,age,note FROM member "</span> +</div><div class="line">        <span class="string">" WHERE name LIKE ?)"</span> +</div><div class="line">        <span class="string">" as total LIMIT ?,?"</span>;</div><div class="line">PreparedStatement stmt = conn.prepareStatement(sql);</div><div class="line">stmt.setString(<span class="number">1</span>,<span class="string">"%"</span> + keywords + <span class="string">"%"</span>);</div><div class="line">stmt.setInt(<span class="number">2</span>, <span class="number">1</span>);</div><div class="line">stmt.setInt(<span class="number">3</span>, <span class="number">2</span>);</div><div class="line">ResultSet rs = stmt.executeQuery();</div><div class="line"><span class="keyword">while</span>(rs.next()){</div><div class="line">    <span class="keyword">int</span> mid = rs.getInt(<span class="number">1</span>);</div><div class="line">    String name = rs.getString(<span class="number">2</span>);</div><div class="line">    Date birthday = rs.getDate(<span class="number">3</span>);</div><div class="line">    <span class="keyword">int</span> age = rs.getInt(<span class="number">4</span>);</div><div class="line">    String note = rs.getString(<span class="number">5</span>);</div><div class="line">    System.out.println(mid + <span class="string">","</span> + name + <span class="string">","</span> + birthday + <span class="string">","</span> + age + <span class="string">","</span> + note);</div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>示例</strong>：统计数据量，使用 <code>COUNT()</code> 函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        String keywords = <span class="string">"李"</span>;</div><div class="line">        <span class="comment">// 第一步：加载数据库驱动程序，此时不需要实例化，会有容器自己负责管理</span></div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        <span class="comment">// 第二步：连接数据库</span></div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        <span class="comment">// 第三步：进行数据库的数据操作</span></div><div class="line"></div><div class="line">        String sql = <span class="string">"SELECT COUNT(mid) FROM member WHERE name LIKE ?"</span>;</div><div class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</div><div class="line">        stmt.setString(<span class="number">1</span>,<span class="string">"%"</span> + keywords + <span class="string">"%"</span>);</div><div class="line">        ResultSet rs = stmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){   <span class="comment">// 只返回一行数据</span></div><div class="line">            <span class="keyword">int</span> count = rs.getInt(<span class="number">1</span>);   <span class="comment">// 取出第一列</span></div><div class="line">            System.out.println(count);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// 第四步： 关闭数据库</span></div><div class="line">        stmt.close();   <span class="comment">// 是可选的 无用的</span></div><div class="line">        conn.close();</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>开发中不会使用 <code>Statement</code> 只会使用 <code>PreparedStatement</code> 接口。</p>
<h4 id="4-_批处理操作">4. 批处理操作</h4>
<p>所谓的批处理指的是一次性向数据库之中发出多条操作命令，一起执行。如果想要操作批处理，还是需要在 Statement 与 PreparedStatement 接口上定义的：</p>
<ul>
<li>Statement 接口定义的方法：<ul>
<li>增加批处理语句：<code>public void addBatch(String sql) throws SQLException</code></li>
<li>执行批处理：<code>public int executeBatch() throws SQLException</code>，返回的数组是包含了所有批处理语句的执行结果；</li>
</ul>
</li>
<li>PreparedStatement 接口定义的方法：<ul>
<li>增加批处理：<code>public void addBatch() throws SQLException</code></li>
</ul>
</li>
</ul>
<p><strong>示例</strong>：Statement 执行批处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.company;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.*;</div><div class="line"><span class="keyword">import</span> java.util.Arrays;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDemo</span> </span>{</div><div class="line">    <span class="comment">// JDBC 驱动名及数据库 URL</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String JDBC_DRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DB_URL = <span class="string">"jdbc:mysql://localhost:3306/test?characterEncoding=UTF-8"</span>;</div><div class="line"></div><div class="line">    <span class="comment">// 数据库的用户名与密码，需要根据自己的设置</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String USER = <span class="string">"root"</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String PASS = <span class="string">"admin"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        Statement stmt = conn.createStatement();</div><div class="line">        stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试A')"</span>);</div><div class="line">        stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试B')"</span>);</div><div class="line">        stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试C')"</span>);</div><div class="line">        stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试D')"</span>);</div><div class="line">        stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试E')"</span>);</div><div class="line">        stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试F')"</span>);</div><div class="line">        <span class="keyword">int</span> result[] = stmt.executeBatch(); <span class="comment">// 执行批处理</span></div><div class="line">        <span class="comment">// 输出：[1, 1, 1, 1, 1, 1]</span></div><div class="line">        System.out.println(Arrays.toString(result));</div><div class="line">        conn.close();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>示例</strong>：PreparedStatement 批处理操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        String sql = <span class="string">"INSERT INTO member(name) VALUES (?)"</span>;</div><div class="line">        PreparedStatement stmt = conn.prepareStatement(sql);</div><div class="line">        <span class="comment">// 设置 SQL 语句</span></div><div class="line">        stmt.setString(<span class="number">1</span>,<span class="string">"测试AA"</span>);</div><div class="line">        <span class="comment">// 将一组参数添加到此 PreparedStatement 对象的批处理命令中</span></div><div class="line">        stmt.addBatch();</div><div class="line">        stmt.setString(<span class="number">1</span>,<span class="string">"测试BB"</span>);</div><div class="line">        stmt.addBatch();</div><div class="line">        stmt.setString(<span class="number">1</span>,<span class="string">"测试CC"</span>);</div><div class="line">        stmt.addBatch();</div><div class="line">        stmt.setString(<span class="number">1</span>,<span class="string">"测试DD"</span>);</div><div class="line">        stmt.addBatch();</div><div class="line">        <span class="keyword">int</span> result[] = stmt.executeBatch(); <span class="comment">// 执行批处理</span></div><div class="line">        <span class="comment">// 输出：[1, 1, 1, 1]</span></div><div class="line">        System.out.println(Arrays.toString(result));</div><div class="line">        conn.close();</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>如果假设以上的五条批处理属于一组关联的操作，如果中间有一条语句执行失败，其他的不应该成功。<br>在批处理操作的过程之中，由于 JDBC 具备有自动的事物提交，所以一旦中间的语句出现了错误，那么结果就是错误的。错误前的语句可以正常执行，错误后的语句无法正常执行，这是不应该的。</p>
<p>可以使用 JDBC 提供的事务处理操作来进行手工的事物控制，所有的操作方法都在 Connection 接口里定义：</p>
<ul>
<li>事物提交：<code>public void commit() throws SQLException</code></li>
<li>事物回滚：<code>public void rollback() throws SQLException</code></li>
<li>设置是否为自动提交：<code>publiv void setAutoCommit(boolean autoCommit) throws SQLException</code></li>
</ul>
<p><strong>示例</strong>：利用事务处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception {</div><div class="line">        Class.forName(JDBC_DRIVER);</div><div class="line">        Connection conn = DriverManager.getConnection(DB_URL,USER,PASS);</div><div class="line">        Statement stmt = conn.createStatement();</div><div class="line">        conn.setAutoCommit(<span class="keyword">false</span>);  <span class="comment">// 取消自动提交</span></div><div class="line">        <span class="keyword">try</span> {</div><div class="line">            stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试AAAAACA')"</span>);</div><div class="line">            stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES (17，sd)"</span>);</div><div class="line">            stmt.addBatch(<span class="string">"INSERT INTO member(name) VALUES ('测试CCCC')"</span>);</div><div class="line">            <span class="keyword">int</span> result[] = stmt.executeBatch(); <span class="comment">// 执行批处理</span></div><div class="line">            System.out.println(Arrays.toString(result));</div><div class="line">            conn.commit();  <span class="comment">// 如果没有出现异常，则提交</span></div><div class="line">        }<span class="keyword">catch</span> (Exception e){</div><div class="line">            e.printStackTrace();</div><div class="line">            conn.rollback();    <span class="comment">// 如果出现异常，则进行回滚</span></div><div class="line">        }</div><div class="line">        conn.close();</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>日后容器会帮助我们自动处理，不需要手工处理。</p>
<h4 id="4-_总结">4. 总结</h4>
<ul>
<li>掌握批处理的执行操作</li>
<li>Connection 接口定义了事物的处理方法： setAutoCommit()、commit()、rollback()。</li>
</ul>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/Java/">Java</a></li></ul></footer></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 JiaojiaoFu</div></footer><script src="/js/scroller.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>
</body></html>