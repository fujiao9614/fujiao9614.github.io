<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="JiaojiaoFu"><link rel="alternative" href="/atom.xml" title="姣姣的个人主页" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Chapter 58 DAO设计模式_分层设计思想 - 姣姣的个人主页</title><link rel="stylesheet" href="/css/main.css" type="text/css">
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css" type="text/css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="/js/fancybox/jquery.fancybox.min.js" type="text/javascript"></script>
</head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">姣姣的个人主页</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-11-04T16:00:00.000Z">November 5, 2018</time><h1 class="post__title"><a href="/2018/11/05/Java_58_DAO设计模式_分层设计思想/">Chapter 58 DAO设计模式_分层设计思想</a></h1><div class="post__main echo"><p>DAO设计模式_分层设计思想，业务层与数据层的开发。<br><a id="more"></a></p>
<h3 id="DAO_设计模式-分层设计思想">DAO 设计模式-分层设计思想</h3>
<h4 id="1-_分层设计思想">1. 分层设计思想</h4>
<ol>
<li>程序的分层<br>每一层都是独立的，可以与其他层进行完整的交互。<br><img src="img/2018-11-01-20-24-21.png" alt=""></li>
</ol>
<p>整个项目中，后台业务层是最核心的部分。<br>业务层是整个程序提供的操作功能，一个业务层的操作要完成需要多个数据层的操作一起完成。<br>整个过程中：发现数据库完成的只是一个个原子性的数据开发库。在实际的开发中，每个业务要牵扯到多个原子性的操作，也就是说所有的原子性的操作业务最终在业务层完成。<br><img src="img/2018-11-01-20-53-37.png" alt=""></p>
<p><strong>数据层</strong>：又被称为数据访问层（Data Access Object，DAO），是专门进行数据库的原子性操作，也就是说在数据层之中最需要控制的就是 JDBC 中的 PreparedStatement 接口的使用；</p>
<p><strong>业务层</strong>：又被称为业务对象（Business Object，BO），但是现在又有一部分认为应该将其成为服务层（Service），业务层核心的目的是调用多个数据层的操作以完成整体的项目的业务设计，这个是整个项目的核心所在。</p>
<h4 id="2-_业务设计实例">2. 业务设计实例</h4>
<p>现在要求使用 emp 表（empno、ename、job、hiredate、sal、comm）实现如下的操作功能：</p>
<ul>
<li>【业务层】：实现雇员数据的添加，但是需要保证被添加的雇员编号不会重复；<ul>
<li>【数据层】：判断要增加的雇员编号是否存在；</li>
<li>【数据层】：如果雇员编号不存在则进行数据的保存操作</li>
</ul>
</li>
<li>【业务层】：实现雇员数据的修改操作<ul>
<li>【数据层】：执行数据的修改操作</li>
</ul>
</li>
<li>【业务层】：实现多个雇员数据的删除操作<ul>
<li>【数据层】：执行雇员的执行删除操作</li>
</ul>
</li>
<li>【业务层】：可以根据雇员编号查找到一个雇员的信息<ul>
<li>【数据层】：根据雇员编号查询指定的雇员数据</li>
</ul>
</li>
<li>【业务层】：可以查询所有雇员的信息<ul>
<li>【数据层】：查询全部雇员数据</li>
</ul>
</li>
<li>【业务层】：可以实现数据的分页显示（模糊查询），同时又可以返回所有的雇员的数量<ul>
<li>【数据层】：雇员数据的分页查询；</li>
<li>【数据层】：使用 COUNT() 函数统计出所有的雇员数量</li>
</ul>
</li>
</ul>
<p><strong>结论</strong>：用户所提出的所有的需求都应该划分为业务层，因为他指的是功能，而开发人员必须要根据业务层进行数据层的设计。</p>
<p>开发人员必须要根据业务层进行数据层的设计。</p>
<h4 id="3-_数据库连接类">3. 数据库连接类</h4>
<ol>
<li>项目准备</li>
</ol>
<p>首先可以设置一个项目名称：DAOProject，并且由于此项目需要使用 Oracle 数据库，需要为其配置好驱动程序。请保证数据库已经打开监听与实例服务。s</p>
<p>为了方便统一管理，父包定义为：cn.mldn，子包要根据不同的功能模块进行划分</p>
<ol start="2">
<li>数据库连接类<br>数据库连接对象的取得和数据库关闭操作。<br><img src="img/2018-11-01-21-19-03.png" alt=""><br>保存在 dbc 子包中。<br>构造方法中实现数据库的连接。</li>
</ol>
<p>示例：定义数据库的专属连接类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.dbc;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.DriverManager;</div><div class="line"><span class="keyword">import</span> java.sql.SQLException;</div><div class="line"></div><div class="line"><span class="javadoc">/**</span></div><div class="line"> * 本类专门负责数据库的连接与关闭操作，在实例化本类对象时就意味着要进行数据的开发</div><div class="line"> * 所以在本类的构造方法里要进行数据库驱动加载与数据库连接取得</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseConnection</span> </span>{</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DBDRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DBURL = <span class="string">"jdbc:mysql://localhost:3306/test?characterEncoding=UTF-8"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String USER = <span class="string">"root"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PASS = <span class="string">"admin"</span>;</div><div class="line">    <span class="keyword">private</span> Connection connection = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 在构造方法里面为 conn 对象进行实例化，可以直接取得数据库的连接对象</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="title">DatabaseConnection</span>(Connection conn) {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            Class.forName(DBDRIVER);</div><div class="line">            <span class="keyword">this</span>.connection = DriverManager.getConnection(DBURL,USER,PASS);</div><div class="line">        }<span class="keyword">catch</span> (Exception e){   <span class="comment">// 此处虽然有异常，但是抛出的意义不大</span></div><div class="line">            e.printStackTrace();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 取得一个数据库的连接对象</div><div class="line">     *<span class="javadoctag"> @return</span> Connection 实例化对象</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Connection <span class="title">getConnection</span>() {</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.connection;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 负责数据库关闭</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span>(){</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.connection != <span class="keyword">null</span>){    <span class="comment">// 表示现在有连接对象</span></div><div class="line">            <span class="keyword">try</span> {</div><div class="line">                <span class="keyword">this</span>.connection.close();</div><div class="line">            } <span class="keyword">catch</span> (SQLException e) {</div><div class="line">                e.printStackTrace();</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>初始设计</p>
<p>额外话题：从最早的 DAO 设计模式来讲实际上还会考虑到一个问题，多数据库间的移植问题，此时就需要设置一个专门的表示连接标准的接口。</p>
<p><img src="img/2018-11-02-08-48-44.png" alt=""></p>
<p>考虑到现实开发中，第三方框架越来越完善，以上复杂的设计几乎不出现了。</p>
<h5 id="4-_开发_Value_Object_VO_类">4. 开发 Value Object   VO 类</h5>
<p><img src="img/2018-11-02-08-53-59.png" alt=""></p>
<p>在实际的工作之中，针对于简单 Java 类的开发给出如下的要求：</p>
<ul>
<li>考虑到日后程序有可能出现的分布式应用问题，所以简单 Java 类必须要实现 java.io.Serializable 接口；</li>
<li>简单 Java 类的名称必须与表名称保持一致；<ul>
<li>有可能采用这样的名字：student_info，类名称为：StudentInfo；</li>
</ul>
</li>
<li>类中的属性不允许使用基本数据类型，都必须使用基本数据类型的包装类；<ul>
<li>基本数据类型的数值型默认值是 0，而如果是包装类默认值就是 null；</li>
</ul>
</li>
<li>类中的属性必须使用 private 封装，封装后的属性必须提供有 setter、getter 方法</li>
<li>类中可以定义有多个构造方法，但是必须要保留有一个无参构造方法；<br>*【可选要求，基本不用】：覆写 equals()、toString()、hashCode();</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> emp(</span></div><div class="line">    empno     <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">    ename    <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</div><div class="line">    job     <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</div><div class="line">    hiredate <span class="built_in">DATE</span>,</div><div class="line">    sal     <span class="keyword">DOUBLE</span>,</div><div class="line">    comm    <span class="keyword">DOUBLE</span>,</div><div class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>(empno)</div><div class="line">)<span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div></pre></td></tr></table></figure>

<p>将所有的简单 Java 类保存在 vo 包中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.vo;</div><div class="line"><span class="keyword">import</span> java.io.Serializable;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="comment">// ("serial") 是序列化警告，当实现了序列化接口的类上缺少serialVersionUID属性的定义时，会出现黄色警告。可以使用@SuppressWarnings将警告关闭</span></div><div class="line"><span class="annotation">@SuppressWarnings</span>(<span class="string">"serial"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>{</div><div class="line">    <span class="keyword">private</span> Integer empno;</div><div class="line">    <span class="keyword">private</span> String ename;</div><div class="line">    <span class="keyword">private</span> String job;</div><div class="line">    <span class="keyword">private</span> Date hiredate;</div><div class="line">    <span class="keyword">private</span> Double sal;</div><div class="line">    <span class="keyword">private</span> Double comm;</div><div class="line">    <span class="comment">// setter、getter 方法省略</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>不管有多少张表，只要是实体表，那么一定要写简单 Java 类，而且不要试图想要一次性将所有的表都转换到位。</p>
<h3 id="数据层">数据层</h3>
<h4 id="5-_数据层接口，开发数据层">5. 数据层接口，开发数据层</h4>
<p>数据层最终是交给业务层进行调用的，所有业务层必须知道数据层的执行标准，即：业务层需要明确的知道数据层。</p>
<ol>
<li>开发数据层操作标准<br><img src="img/2018-11-02-09-03-06.png" alt=""></li>
</ol>
<p>【<strong>重点</strong>】：<br>对于数据层的接口给出如下的开发要求：</p>
<ul>
<li>数据层既然是进行数据操作的，那么就将其保存在 dao 包下；</li>
<li>既然不同的数据表的操作有可能使用不同的数据层开发，那么就针对数据表进行命名<ul>
<li>emp 表，那么数据层的接口就应该定义为 IEmpDAO；</li>
</ul>
</li>
<li>对于整个数据层的开发严格来讲就只有两类功能：<ul>
<li>数据更新：建议他的操作方法以 doXxx() 的姓氏命名，例如 doCreate()、doUpdate()、doRemove()；</li>
<li>数据查询：对于查询分为两种形式：<ul>
<li>查询表中数据：以 findXxx() 形式命名，例如 findById()、findByName()、findAll()；</li>
<li>统计表中的数据：以 getXxx() 形式命名，例如 getAllCount()</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>示例</strong>：编写 EMP 表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.dao;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Emp;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"><span class="javadoc">/**</span></div><div class="line"> * 定义 emp 表的数据层的操作标准</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEmpDAO</span> </span>{</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 实现数据的增加操作</div><div class="line">     *<span class="javadoctag"> @param</span> vo 包含了要增加数据的 VO 对象</div><div class="line">     *<span class="javadoctag"> @return</span> 数据保存成功返回 true，否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doCreate</span>(Emp vo) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 实现数据的修改操作，本次修改是根据 id 进行全部字段的修改</div><div class="line">     *<span class="javadoctag"> @param</span> vo 包括了要修改数据的信息，一定要提供有 ID 内容</div><div class="line">     *<span class="javadoctag"> @return</span> 数据修改成功返回 true，否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doUpdate</span>(Emp vo) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 执行数据的批量删除操作，所有要删除的数据以 Set 集合的形式保存</div><div class="line">     *<span class="javadoctag"> @param</span> ids 包含了所有要删除的数据 ID，不包含重复内容</div><div class="line">     *<span class="javadoctag"> @return</span> 删除成功返回 true（删除的数据个数与要删除的数据个数相同），否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doRemoveBatch</span>(Set&lt;Integer&gt; ids) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 根据雇员编号查询指定的雇员信息</div><div class="line">     *<span class="javadoctag"> @param</span> id 要查询的雇员编号</div><div class="line">     *<span class="javadoctag"> @return</span> 如果雇员信息存在，数据以 VO 类对象的形式返回；如果雇员信息不存在，则返回 null</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Emp <span class="title">findById</span>(Integer id) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 查询指定数据表的全部记录，并且以集合的形式返回</div><div class="line">     *<span class="javadoctag"> @return</span> 表中有数据，则将数据封装为 VO 类对象然后利用 List 集合返回，&lt;br&gt;</div><div class="line">     * 如果没有数据，那么集合的长度为 0（size() == 0，不是 null）&lt;/&gt;</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAll</span>() <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 分页进行数据的模糊查询，查询结果以集合的形式返回</div><div class="line">     *<span class="javadoctag"> @param</span> offset 数据行的偏移量</div><div class="line">     *<span class="javadoctag"> @param</span> maxNum 数据行的最大数目</div><div class="line">     *<span class="javadoctag"> @param</span> column 进行模糊查询的数据列</div><div class="line">     *<span class="javadoctag"> @param</span> keyWord 模糊查询的关键字</div><div class="line">     *<span class="javadoctag"> @return</span> 中有数据，则将数据封装为 VO 类对象然后利用 List 集合返回，&lt;br&gt;</div><div class="line">     * 如果没有数据，那么集合的长度为 0（size() == 0，不是 null）&lt;/&gt;</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAllSplit</span>(Integer offset,Integer maxNum,String column,String keyWord) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 进行模糊查询数据量的统计，如果表中没有记录统计的结果就是 0</div><div class="line">     *<span class="javadoctag"> @param</span> column 进行模糊查询的数据列</div><div class="line">     *<span class="javadoctag"> @param</span> keyWord 模糊查询的关键字</div><div class="line">     *<span class="javadoctag"> @return</span> 返回表中的数据量，如果没有数据就返回 0</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Integer <span class="title">getAllCount</span>(String column,String keyWord) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>

<p>示意图：</p>
<p><img src="img/2018-11-02-13-40-08.png" alt=""></p>
<h4 id="6-_数据实现类">6. 数据实现类</h4>
<p>数据层需要被业务层调用，数据层需要进行数据库的执行（PreparedStatement），要执行多个数据层的调用，所以数据库的打开与关闭操作应该由业务层控制。</p>
<p>所有的数据层实现类要求保存在 dao.impl 子包下。</p>
<p><strong>范例</strong>：EmpDAOImpl 子类</p>
<p>不用关闭，关闭给业务层做。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.dao.impl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.dao.IEmpDAO;</div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Emp;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</div><div class="line"><span class="keyword">import</span> java.sql.ResultSet;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpDAOImpl</span> <span class="keyword">implements</span> <span class="title">IEmpDAO</span> </span>{</div><div class="line">    <span class="keyword">private</span> Connection conn;</div><div class="line">    <span class="keyword">private</span> PreparedStatement pstmt;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 如果想要使用数据层进行原子性的功能操作实现，必须要提供有 Connection 接口对象</div><div class="line">     * 另外，由于开发之中业务层要调用数据层，所以数据库的打开与关闭交由业务层处理</div><div class="line">     *<span class="javadoctag"> @param</span> conn 表示数据库的连接对象</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="title">EmpDAOImpl</span>(Connection conn){</div><div class="line">        <span class="keyword">this</span>.conn = conn;</div><div class="line">    }</div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doCreate</span>(Emp vo) <span class="keyword">throws</span> Exception {</div><div class="line">        String sql = <span class="string">"INSERT INTO emp(empno,ename,job,hiredate,sal,comm) VALUES(?,?,?,?,?,?)"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">1</span>,vo.getEmpno());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">2</span>,vo.getEname());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">3</span>,vo.getJob());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDate(<span class="number">4</span>,<span class="keyword">new</span> java.sql.Date(vo.getHiredate().getTime()));</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">5</span>,vo.getSal());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">6</span>,vo.getComm());</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() &gt; <span class="number">0</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doUpdate</span>(Emp vo) <span class="keyword">throws</span> Exception {</div><div class="line">        String sql = <span class="string">"UPDATE emp SET ename=?,job=?,hiredate=?,sal=?,comm=? WHERE empno=?"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">1</span>,vo.getEname());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">2</span>,vo.getJob());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDate(<span class="number">3</span>,<span class="keyword">new</span> java.sql.Date(vo.getHiredate().getTime()));</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">4</span>,vo.getSal());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">5</span>,vo.getComm());</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">6</span>,vo.getEmpno());</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() &gt; <span class="number">0</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doRemoveBatch</span>(Set&lt;Integer&gt; ids) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">if</span>(ids == <span class="keyword">null</span> || ids.size() == <span class="number">0</span>){ <span class="comment">// 没有要删除的数据</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        StringBuffer sql = <span class="keyword">new</span> StringBuffer();</div><div class="line">        sql.append(<span class="string">"DELETE FROM emp WHERE empno IN ("</span>);</div><div class="line">        Iterator&lt;Integer&gt; iter = ids.iterator();</div><div class="line">        <span class="keyword">while</span>(iter.hasNext()){</div><div class="line">            sql.append(iter.next()).append(<span class="string">","</span>);</div><div class="line">        }</div><div class="line">        sql.delete(sql.length()-<span class="number">1</span>,sql.length()).append(<span class="string">")"</span>);</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql.toString());</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() == ids.size();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Emp <span class="title">findById</span>(Integer id) <span class="keyword">throws</span> Exception {</div><div class="line">        Emp vo = <span class="keyword">null</span>;</div><div class="line">        String sql = <span class="string">"SELECT empno,ename,job,hiredate,sal,comm FROM emp WHERE empno=?"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">1</span>,id);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            vo = <span class="keyword">new</span> Emp();</div><div class="line">            vo.setEmpno(rs.getInt(<span class="number">1</span>));</div><div class="line">            vo.setEname(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setJob(rs.getString(<span class="number">3</span>));</div><div class="line">            vo.setHiredate(rs.getDate(<span class="number">4</span>));</div><div class="line">            vo.setSal(rs.getDouble(<span class="number">5</span>));</div><div class="line">            vo.setComm(rs.getDouble(<span class="number">6</span>));</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> vo;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAll</span>() <span class="keyword">throws</span> Exception {</div><div class="line">        List&lt;Emp&gt; all = <span class="keyword">new</span> ArrayList&lt;Emp&gt;();</div><div class="line">        String sql = <span class="string">"SELECT empno,ename,job,hiredate,sal,comm FROM emp"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            Emp vo = <span class="keyword">new</span> Emp();</div><div class="line">            vo.setEmpno(rs.getInt(<span class="number">1</span>));</div><div class="line">            vo.setEname(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setJob(rs.getString(<span class="number">3</span>));</div><div class="line">            vo.setHiredate(rs.getDate(<span class="number">4</span>));</div><div class="line">            vo.setSal(rs.getDouble(<span class="number">5</span>));</div><div class="line">            vo.setComm(rs.getDouble(<span class="number">6</span>));</div><div class="line">            all.add(vo);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> all;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAllSplit</span>(Integer offset, Integer maxNum, String column, String keyWord) <span class="keyword">throws</span> Exception {</div><div class="line">        List&lt;Emp&gt; all = <span class="keyword">new</span> ArrayList&lt;Emp&gt;();</div><div class="line">        String sql = <span class="string">" SELECT * FROM "</span> +</div><div class="line">                <span class="string">" (SELECT empno,ename,job,hiredate,sal,comm FROM emp WHERE "</span> + column +</div><div class="line">                <span class="string">" LIKE ? ) as total "</span> +</div><div class="line">                <span class="string">" LIMIT ?,? "</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">1</span>,<span class="string">"%"</span>+keyWord+<span class="string">"%"</span>);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">2</span>,offset);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">3</span>,maxNum);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            Emp vo = <span class="keyword">new</span> Emp();</div><div class="line">            vo.setEmpno(rs.getInt(<span class="number">1</span>));</div><div class="line">            vo.setEname(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setJob(rs.getString(<span class="number">3</span>));</div><div class="line">            vo.setHiredate(rs.getDate(<span class="number">4</span>));</div><div class="line">            vo.setSal(rs.getDouble(<span class="number">5</span>));</div><div class="line">            vo.setComm(rs.getDouble(<span class="number">6</span>));</div><div class="line">            all.add(vo);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> all;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Integer <span class="title">getAllCount</span>(String column, String keyWord) <span class="keyword">throws</span> Exception {</div><div class="line">        String sql = <span class="string">"SELECT COUNT(empno) FROM emp WHERE "</span> + column + <span class="string">" LIKE ?"</span> ;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">1</span>,<span class="string">"%"</span>+keyWord+<span class="string">"%"</span>);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            <span class="keyword">return</span> rs.getInt(<span class="number">1</span>);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>子类里面唯一要注意的就是要接收一个 Connection 接口对象。</p>
<p><img src="img/2018-11-02-15-21-16.png" alt=""></p>
<h5 id="7-_定义数据层工厂类_–_DAOFactory">7. 定义数据层工厂类 – DAOFactory</h5>
<p>业务层要想进行数据层的调用，那么必须要取得 IEmpDAO 接口对象，但是不同层之间如果想要取得接口对象示例，需要使用工厂设计模式，这个工厂类将其保存在 factory 子包下。</p>
<p><strong>示例</strong>：定义工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.factory;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.dao.IEmpDAO;</div><div class="line"><span class="keyword">import</span> cn.mldn.dao.impl.EmpDAOImpl;</div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DAOFactory</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IEmpDAO <span class="title">getIEmpDAOInstance</span>(Connection conn){</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EmpDAOImpl(conn);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用工厂类的特征就是外层不需要知道具体的子类。</p>
<p><img src="img/2018-11-02-15-26-10.png" alt=""></p>
<h3 id="业务层">业务层</h3>
<h4 id="8-_开发业务层，业务层接口_-_IEmpService">8. 开发业务层，业务层接口 - IEmpService</h4>
<p>业务层也可以成为 Service 层，既然描述的是 emp 表的操作，所以名称就定义为 IEmpService，并且保存在 service 子包下，但是对于业务层的方法定义没有明确的要求。（建议有一定的规范！）</p>
<p>注意：数据层使用包装类，业务层使用基本类型<br>delete(Set<integer> ids) 只能使用包装类</integer></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.service;</div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Emp;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="javadoc">/**</span></div><div class="line"> * 定义 emp 表的业务层的执行标准，此类一定要负责数据库的打开与关闭操作</div><div class="line"> * 此类可以通过 DAOFactory 类取得 IEmpDAO 接口对象</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEmpService</span> </span>{</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 实现雇员数据的增加操作，本次要调用 IEmpDAO 接口中的如下方法：&lt;br&gt;</div><div class="line">     * &lt;li&gt;需要调用 IEmpDAO.findById() 方法，判断要增加数据的 id 是否存在&lt;/&gt;</div><div class="line">     * &lt;li&gt;如果现在要增加的数据编号不存在则调用 IEmpDAO.doCreate() 方法，返回操作结果&lt;/li&gt;</div><div class="line">     *<span class="javadoctag"> @param</span> vo 包含了要增加数据的 VO 对象</div><div class="line">     *<span class="javadoctag"> @return</span>  如果要增加数据的 ID 重复或者保存失败则返回 false，否则返回 true</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">insert</span>(Emp vo) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 实现雇员数据的修改操作，本次要调用 IEmpDAO.doUpdate() 方法，本次修改属于全部内容修改</div><div class="line">     *<span class="javadoctag"> @param</span> vo 包含了要修改数据的 VO 对象</div><div class="line">     *<span class="javadoctag"> @return</span> 修改成功返回 true，否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span>(Emp vo) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 执行雇员数据的删除操作，可以删除多个雇员信息，调用 IEmpDAO.doRemoveBatch() 方法</div><div class="line">     *<span class="javadoctag"> @param</span> ids 包含了全部要删除数据的集合，没有重复数据</div><div class="line">     *<span class="javadoctag"> @return</span> 删除成功返回 true，否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span>(Set&lt;Integer&gt; ids) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 根据雇员编号查找雇员的完整信息，调用 IEmpDAO.findById() 方法</div><div class="line">     *<span class="javadoctag"> @param</span> ids 要查找的雇员编号</div><div class="line">     *<span class="javadoctag"> @return</span> 如果找到了则雇员信息以 VO 对象返回，否则返回 null</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Emp <span class="title">get</span>(<span class="keyword">int</span> ids) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 查询全部雇员信息，调用 IEmpDAO.findAll() 方法</div><div class="line">     *<span class="javadoctag"> @return</span> 查询结果以 List 集合形式返回，如果没有数据则返回集合的长度为 0</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">list</span>() <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 实现数据的模糊查询与数据统计，调用 IEmpDAO 中的两个方法&lt;br&gt;</div><div class="line">     * &lt;li&gt;调用 IEmpDAO.findAllSplit() 方法，查询出所有的表数据，返回 List&lt;Emp&gt; &lt;/&gt;</div><div class="line">     * &lt;li&gt;调用 IEmpDAO.getAllCount() 方法，查询所有的数据量，返回的 Integer &lt;/&gt;&lt;/&gt;</div><div class="line">     *<span class="javadoctag"> @param</span> offset 数据行的偏移量</div><div class="line">     *<span class="javadoctag"> @param</span> maxNum 数据行的最大数目</div><div class="line">     *<span class="javadoctag"> @param</span> column 进行模糊查询的数据列</div><div class="line">     *<span class="javadoctag"> @param</span> keyWord 模糊查询的关键字</div><div class="line">     *<span class="javadoctag"> @return</span> 本方法需要返回多种数据类型，所以使用 Map 集合返回，由于类型不统一，所有 value 的类型设置为以下两种：&lt;br&gt;</div><div class="line">     * &lt;li&gt;key = allEmps, value = IEmpDAO.findAllSplit() 返回结果，List&lt;Emp&gt;;&lt;/&gt;</div><div class="line">     * &lt;li&gt;key = empCount, value = IEmpDAO.getAllCount() 返回结果，Integer &lt;/&gt;&lt;/&gt;</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">list</span>(<span class="keyword">int</span> offset,<span class="keyword">int</span> maxNum,String column,String keyWord) <span class="keyword">throws</span> Exception;</div><div class="line">}</div></pre></td></tr></table></figure>

<h4 id="9-_业务层实现类">9. 业务层实现类</h4>
<p>业务层实现类的核心功能：</p>
<ul>
<li>负责控制数据库的打开和关闭：当存在了业务层对象后其目的就是为操作数据库，即：业务层对象实例化之后就必须准备好数据连接；</li>
<li>根据 DAOFactory 调用 getIEmpDAOInstance() 方法 而后取得 IEmpDAO 接口对象</li>
</ul>
<p>业务层的实现类保存在 dao.impl 子包中。</p>
<p><strong>示例</strong>：定义 EmpServiceImpl 子类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.dao.impl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.dbc.DatabaseConnection;</div><div class="line"><span class="keyword">import</span> cn.mldn.factory.DAOFactory;</div><div class="line"><span class="keyword">import</span> cn.mldn.service.IEmpService;</div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Emp;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title">IEmpService</span> </span>{</div><div class="line">    <span class="comment">// 在这个类的对象内部提供有一个数据库连接类的实例化对象</span></div><div class="line">    <span class="keyword">private</span> DatabaseConnection dbc = <span class="keyword">new</span> DatabaseConnection();</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">insert</span>(Emp vo) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="comment">// 要增加的雇员编号如果不存在，则 findById() 返回的结果就是 null，null 表示可以进行新雇员数据的保存</span></div><div class="line">            <span class="keyword">if</span>(DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findById(vo.getEmpno()) == <span class="keyword">null</span>){</div><div class="line">                <span class="keyword">return</span> DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).doCreate(vo);</div><div class="line">            }</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }<span class="keyword">catch</span> (Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span> {</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span>(Emp vo) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).doUpdate(vo);</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span> {</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span>(Set&lt;Integer&gt; ids) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span> {</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).doRemoveBatch(ids);</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span> {</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Emp <span class="title">get</span>(<span class="keyword">int</span> ids) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findById(ids);</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span>{</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">list</span>() <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findAll();</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span>{</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">list</span>(<span class="keyword">int</span> offset, <span class="keyword">int</span> maxNum, String column, String keyWord) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">            map.put(<span class="string">"allEmps"</span>,DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findAllSplit(offset,maxNum,column,keyWord));</div><div class="line">            map.put(<span class="string">"empCount"</span>,DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).getAllCount(column,keyWord));</div><div class="line">            <span class="keyword">return</span> map;</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span>{</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>不同层之间的访问依靠的就是工厂类和接口进行操作。</p>
<p>【技巧】：只要写接口，取得对象就使用工厂。</p>
<p><img src="img/2018-11-04-15-36-20.png" alt=""></p>
<h4 id="10-_定义业务层的工厂类：ServiceFactory">10. 定义业务层的工厂类：ServiceFactory</h4>
<p>业务层最终依然需要被其他的层所使用，所以需要为其定义工厂类，该类也同样保存在 factory 子包下，从开发角度来讲，业务层应该分为两种：</p>
<ul>
<li>前台业务逻辑：可以将其保存在 service.front 包中，工厂类：ServiceFrontFactory</li>
<li>后台业务逻辑：可以将其保存在 service.back 包中，工厂类：ServiceBackFactory。</li>
</ul>
<p><strong>示例</strong>：定义 ServiceFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.factory;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.dao.impl.EmpServiceImpl;</div><div class="line"><span class="keyword">import</span> cn.mldn.service.IEmpService;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceFactory</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IEmpService <span class="title">getIEmpServiceInstance</span>(){</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EmpServiceImpl();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p><img src="img/2018-11-04-15-40-41.png" alt=""></p>
<h3 id="业务测试">业务测试</h3>
<h4 id="11-_调用测试">11. 调用测试</h4>
<p><strong>示例</strong>：数据插入测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.cn.mldn.test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.factory.ServiceFactory;</div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Emp;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEmpInsert</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String args[]){</div><div class="line">        Emp vo = <span class="keyword">new</span> Emp();</div><div class="line">        vo.setEmpno(<span class="number">001</span>);</div><div class="line">        vo.setEname(<span class="string">"Mary"</span>);</div><div class="line">        vo.setJob(<span class="string">"秘书"</span>);</div><div class="line">        vo.setHiredate(<span class="keyword">new</span> Date());</div><div class="line">        vo.setSal(<span class="number">2000.0</span>);</div><div class="line">        vo.setComm(<span class="number">888.0</span>);</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            System.out.println(ServiceFactory.getIEmpServiceInstance().insert(vo));</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            e.printStackTrace();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>运行第一次返回 true，第二次返回 false（empno 重复，无法插入）</p>
<p><strong>示例</strong>：测试分页查询功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.cn.mldn.test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.factory.ServiceFactory;</div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Emp;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEmpSplit</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String []args){</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            Map&lt;String,Object&gt; map = ServiceFactory.getIEmpServiceInstance().list(<span class="number">1</span>,<span class="number">3</span>,<span class="string">"ename"</span>,<span class="string">""</span>);</div><div class="line">            <span class="keyword">int</span> count = (Integer) map.get(<span class="string">"empCount"</span>);</div><div class="line">            System.out.println(<span class="string">"数据量："</span>+ count);</div><div class="line">            List&lt;Emp&gt; all = (List&lt;Emp&gt;) map.get(<span class="string">"allEmps"</span>);</div><div class="line">            Iterator&lt;Emp&gt; iter = all.iterator();</div><div class="line">            <span class="keyword">while</span>(iter.hasNext()){</div><div class="line">                Emp vo = iter.next();</div><div class="line">                System.out.println(<span class="string">"姓名："</span> + vo.getEname() + <span class="string">",职业："</span> + vo.getJob());</div><div class="line">            }</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            e.printStackTrace();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h4 id="12-_利用_junit_进行测试">12. 利用 junit 进行测试</h4>
<h3 id="深入讲解">深入讲解</h3>
<h4 id="13-_实现部门操作">13. 实现部门操作</h4>
<p><img src="img/2018-11-04-19-29-26.png" alt=""></p>
<ol>
<li>定义 Dept.java<br>实现简单 java 类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.vo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.Serializable;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dept</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>{</div><div class="line">    <span class="keyword">private</span> Integer deptno;</div><div class="line">    <span class="keyword">private</span> String dname;</div><div class="line">    <span class="keyword">private</span> String loc;</div><div class="line">    <span class="comment">// 省略 setter、getter</span></div><div class="line">}</div></pre></td></tr></table></figure>

<ol start="2">
<li>定义 IDeptDAO 接口<br>几乎所有的数据表都应该具备有基础 CRUD 功能（增加、修改全部、删除数据、根据编号查询、查询全部、分页显示、数据统计），这些功能呢的方法每个接口都要重复定义。<br>在整个 DAO 接口定义过程之中，不同表的区别在于 VO类、主键类型。</li>
</ol>
<p>定义一个公共父类 IDAO.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.dao;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="javadoc">/**</span></div><div class="line"> * 定义公共的 DAO 操作接口标准，增加、修改全部、删除数据、根据编号查询、查询全部、分页显示、数据统计</div><div class="line"> *<span class="javadoctag"> @param</span> &lt;K&gt; 表示要操作的主键类型，由子接口实现</div><div class="line"> *<span class="javadoctag"> @param</span> &lt;V&gt; 表示要操作的 VO 类型，由子接口实现</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IDAO</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>{</div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 实现数据的增加操作</div><div class="line">     *<span class="javadoctag"> @param</span> vo 包含了要增加数据的 VO 对象</div><div class="line">     *<span class="javadoctag"> @return</span> 数据保存成功返回 true，否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doCreate</span>(V vo) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 实现数据的修改操作，本次修改是根据 id 进行全部字段的修改</div><div class="line">     *<span class="javadoctag"> @param</span> vo 包括了要修改数据的信息，一定要提供有 ID 内容</div><div class="line">     *<span class="javadoctag"> @return</span> 数据修改成功返回 true，否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doUpdate</span>(V vo) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 执行数据的批量删除操作，所有要删除的数据以 Set 集合的形式保存</div><div class="line">     *<span class="javadoctag"> @param</span> ids 包含了所有要删除的数据 ID，不包含重复内容</div><div class="line">     *<span class="javadoctag"> @return</span> 删除成功返回 true（删除的数据个数与要删除的数据个数相同），否则返回 false</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doRemoveBatch</span>(Set&lt;K&gt; ids) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 根据雇员编号查询指定的雇员信息</div><div class="line">     *<span class="javadoctag"> @param</span> id 要查询的雇员编号</div><div class="line">     *<span class="javadoctag"> @return</span> 如果雇员信息存在，数据以 VO 类对象的形式返回；如果雇员信息不存在，则返回 null</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> V <span class="title">findById</span>(K id) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 查询指定数据表的全部记录，并且以集合的形式返回</div><div class="line">     *<span class="javadoctag"> @return</span> 表中有数据，则将数据封装为 VO 类对象然后利用 List 集合返回，&lt;br&gt;</div><div class="line">     * 如果没有数据，那么集合的长度为 0（size() == 0，不是 null）&lt;/&gt;</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> List&lt;V&gt; <span class="title">findAll</span>() <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 分页进行数据的模糊查询，查询结果以集合的形式返回</div><div class="line">     *<span class="javadoctag"> @param</span> offset 数据行的偏移量</div><div class="line">     *<span class="javadoctag"> @param</span> maxNum 数据行的最大数目</div><div class="line">     *<span class="javadoctag"> @param</span> column 进行模糊查询的数据列</div><div class="line">     *<span class="javadoctag"> @param</span> keyWord 模糊查询的关键字</div><div class="line">     *<span class="javadoctag"> @return</span> 中有数据，则将数据封装为 VO 类对象然后利用 List 集合返回，&lt;br&gt;</div><div class="line">     * 如果没有数据，那么集合的长度为 0（size() == 0，不是 null）&lt;/&gt;</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> List&lt;V&gt; <span class="title">findAllSplit</span>(Integer offset,Integer maxNum,String column,String keyWord) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 进行模糊查询数据量的统计，如果表中没有记录统计的结果就是 0</div><div class="line">     *<span class="javadoctag"> @param</span> column 进行模糊查询的数据列</div><div class="line">     *<span class="javadoctag"> @param</span> keyWord 模糊查询的关键字</div><div class="line">     *<span class="javadoctag"> @return</span> 返回表中的数据量，如果没有数据就返回 0</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Integer <span class="title">getAllCount</span>(String column,String keyWord) <span class="keyword">throws</span> Exception;</div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>示例</strong>：定义 IEmpDAO 子接口</p>
<p><img src="img/2018-11-04-19-37-54.png" alt=""></p>
<ol start="3">
<li>定义 DeptDAOImpl 子类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.dao.impl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.dao.IDeptDAO;</div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Dept;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</div><div class="line"><span class="keyword">import</span> java.sql.ResultSet;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptDAOImpl</span> <span class="keyword">implements</span> <span class="title">IDeptDAO</span> </span>{</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Connection conn;</div><div class="line">    <span class="keyword">private</span> PreparedStatement pstmt;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">DeptDAOImpl</span>(Connection conn) {</div><div class="line">        <span class="keyword">this</span>.conn = conn;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doCreate</span>(Dept vo) <span class="keyword">throws</span> Exception {</div><div class="line">        String sql = <span class="string">"INSERT INTO dept(deptno,dname,loc) VALUES(?,?,?)"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">1</span>,vo.getDeptno());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">2</span>,vo.getDname());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">3</span>,vo.getLoc());</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() &gt; <span class="number">0</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doUpdate</span>(Dept vo) <span class="keyword">throws</span> Exception {</div><div class="line">        String sql = <span class="string">"UPDATE dept SET dname=?,loc=? WHERE deptno=?"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">1</span>,vo.getDname());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">2</span>,vo.getLoc());</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">3</span>,vo.getDeptno());</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() &gt; <span class="number">0</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doRemoveBatch</span>(Set&lt;Integer&gt; ids) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">if</span>(ids == <span class="keyword">null</span> || ids.size() == <span class="number">0</span>){ <span class="comment">// 没有要删除的数据</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        StringBuffer sql = <span class="keyword">new</span> StringBuffer();</div><div class="line">        sql.append(<span class="string">"DELETE FROM dept WHERE deptno IN ("</span>);</div><div class="line">        Iterator&lt;Integer&gt; iter = ids.iterator();</div><div class="line">        <span class="keyword">while</span>(iter.hasNext()){</div><div class="line">            sql.append(iter.next()).append(<span class="string">","</span>);</div><div class="line">        }</div><div class="line">        sql.delete(sql.length()-<span class="number">1</span>,sql.length()).append(<span class="string">")"</span>);</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql.toString());</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() == ids.size();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Dept <span class="title">findById</span>(Integer id) <span class="keyword">throws</span> Exception {</div><div class="line">        Dept vo = <span class="keyword">null</span>;</div><div class="line">        String sql = <span class="string">"SELECT deptno,dname,loc FROM dept WHERE deptno=?"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">1</span>,id);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span> (rs.next()){</div><div class="line">            vo = <span class="keyword">new</span> Dept();</div><div class="line">            vo.setDeptno(rs.getInt(<span class="number">1</span>));</div><div class="line">            vo.setDname(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setLoc(rs.getString(<span class="number">3</span>));</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> vo;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title">findAll</span>() <span class="keyword">throws</span> Exception {</div><div class="line">        List&lt;Dept&gt; all = <span class="keyword">new</span> ArrayList&lt;Dept&gt;();</div><div class="line">        String sql = <span class="string">"SELECT deptno,dname,loc FROM dept"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span> (rs.next()){</div><div class="line">            Dept vo = <span class="keyword">new</span> Dept();</div><div class="line">            vo.setDeptno(rs.getInt(<span class="number">1</span>));</div><div class="line">            vo.setDname(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setLoc(rs.getString(<span class="number">3</span>));</div><div class="line">            all.add(vo);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> all;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title">findAllSplit</span>(Integer offset, Integer maxNum, String column, String keyWord) <span class="keyword">throws</span> Exception {</div><div class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"此方法未实现"</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Integer <span class="title">getAllCount</span>(String column, String keyWord) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"此方法未实现"</span>);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>对于未实现的方法：<br>抛出异常： <code>此方法未实现</code></p>
<ol start="4">
<li>修改 DAOFactory 类，增加新的接口对象取得方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> IDeptDAO <span class="title">getIDeptDAOInstance</span>(Connection conn){</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DeptDAOImpl(conn);</div><div class="line">    }</div></pre></td></tr></table></figure>

<ol start="5">
<li>开发 IDeptService 接口<br>业务层最好不要做方法抽象，因为面向用户，要保证所有的方法可用。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.service;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Dept;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IDeptService</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">insert</span>(Dept vo) <span class="keyword">throws</span> Exception;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span>(Dept vo) <span class="keyword">throws</span> Exception;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span>(Set&lt;Integer&gt; ids) <span class="keyword">throws</span> Exception;</div><div class="line">    <span class="keyword">public</span> Dept <span class="title">get</span>(<span class="keyword">int</span> ids) <span class="keyword">throws</span> Exception;</div><div class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title">list</span>() <span class="keyword">throws</span> Exception;</div><div class="line">}</div></pre></td></tr></table></figure>

<ol start="6">
<li>实现 DeptServiceImpl 子类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.mldn.dao.impl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.mldn.dbc.DatabaseConnection;</div><div class="line"><span class="keyword">import</span> cn.mldn.factory.DAOFactory;</div><div class="line"><span class="keyword">import</span> cn.mldn.service.IDeptService;</div><div class="line"><span class="keyword">import</span> cn.mldn.vo.Dept;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title">IDeptService</span></span>{</div><div class="line">    <span class="keyword">private</span> DatabaseConnection dbc = <span class="keyword">new</span> DatabaseConnection();</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">insert</span>(Dept vo) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="comment">// 要增加的dept编号如果不存在，则 findById() 返回的结果就是 null，null 表示可以进行新数据的保存</span></div><div class="line">            <span class="keyword">if</span>(DAOFactory.getIDeptDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findById(vo.getDeptno()) == <span class="keyword">null</span>){</div><div class="line">                <span class="keyword">return</span> DAOFactory.getIDeptDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).doCreate(vo);</div><div class="line">            }</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }<span class="keyword">catch</span> (Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span> {</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span>(Dept vo) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIDeptDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).doUpdate(vo);</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span> {</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span>(Set&lt;Integer&gt; ids) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span> {</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIDeptDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).doRemoveBatch(ids);</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span> {</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Dept <span class="title">get</span>(<span class="keyword">int</span> ids) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIDeptDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findById(ids);</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span>{</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title">list</span>() <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            <span class="keyword">return</span> DAOFactory.getIDeptDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findAll();</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span> {</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<ol start="7">
<li>修改服务层工厂类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> IDeptService <span class="title">getIDeptServiceInstance</span>() { </div><div class="line">     <span class="keyword">return</span> <span class="keyword">new</span> DeptServiceImpl(); </div><div class="line">}</div></pre></td></tr></table></figure>

<h4 id="14-_处理关系（了解）">14. 处理关系（了解）</h4>
<p>已经实现了雇员和部门的基础操作，但是在雇员里面存在有 mgr 和 deptno 两个关联对象，修改 VO 类的定义；</p>
<ul>
<li>修改 Emp.java 类，SQL 数据表也要变化</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Emp mgr;</div><div class="line"><span class="keyword">private</span> Dept dept;</div><div class="line"><span class="comment">// 增加这两个属性及其 setter、getter 方法</span></div></pre></td></tr></table></figure>

<ul>
<li>修改 Dept.java 类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> List&lt;Emp&gt; emps;</div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">getEmps</span>() {</div><div class="line">        <span class="keyword">return</span> emps;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmps</span>(List&lt;Emp&gt; emps) {</div><div class="line">        <span class="keyword">this</span>.emps = emps;</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>增加数据要变化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doCreate</span>(Emp vo) <span class="keyword">throws</span> Exception {</div><div class="line">        String sql = <span class="string">"INSERT INTO emp(empno,ename,job,hiredate,sal,comm,mgr,dept) VALUES(?,?,?,?,?,?,?,?)"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">1</span>,vo.getEmpno());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">2</span>,vo.getEname());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">3</span>,vo.getJob());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDate(<span class="number">4</span>,<span class="keyword">new</span> java.sql.Date(vo.getHiredate().getTime()));</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">5</span>,vo.getSal());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">6</span>,vo.getComm());</div><div class="line">        <span class="keyword">if</span>(vo.getMgr() == <span class="keyword">null</span>){    <span class="comment">// 未设置领导数据</span></div><div class="line">            <span class="keyword">this</span>.pstmt.setNull(<span class="number">7</span>, Type.NULL);</div><div class="line">        }<span class="keyword">else</span>{</div><div class="line">            <span class="keyword">this</span>.pstmt.setInt(<span class="number">7</span>,vo.getMgr().getEmpno());</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span>(vo.getDept() == <span class="keyword">null</span>){</div><div class="line">            <span class="keyword">this</span>.pstmt.setNull(<span class="number">8</span>, Type.NULL);</div><div class="line">        }<span class="keyword">else</span>{</div><div class="line">            <span class="keyword">this</span>.pstmt.setInt(<span class="number">8</span>,vo.getDept().getDeptno());</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() &gt; <span class="number">0</span>;</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>修改数据也要变化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doUpdate</span>(Emp vo) <span class="keyword">throws</span> Exception {</div><div class="line">        String sql = <span class="string">"UPDATE emp SET ename=?,job=?,hiredate=?,sal=?,comm=?,mgr=?,dept=? WHERE empno=?"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">1</span>,vo.getEname());</div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">2</span>,vo.getJob());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDate(<span class="number">3</span>,<span class="keyword">new</span> java.sql.Date(vo.getHiredate().getTime()));</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">4</span>,vo.getSal());</div><div class="line">        <span class="keyword">this</span>.pstmt.setDouble(<span class="number">5</span>,vo.getComm());</div><div class="line">        <span class="keyword">if</span>(vo.getMgr() == <span class="keyword">null</span>){    <span class="comment">// 未设置领导数据</span></div><div class="line">            <span class="keyword">this</span>.pstmt.setNull(<span class="number">6</span>, Type.NULL);</div><div class="line">        }<span class="keyword">else</span>{</div><div class="line">            <span class="keyword">this</span>.pstmt.setInt(<span class="number">6</span>,vo.getMgr().getEmpno());</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span>(vo.getDept() == <span class="keyword">null</span>){</div><div class="line">            <span class="keyword">this</span>.pstmt.setNull(<span class="number">7</span>, Type.NULL);</div><div class="line">        }<span class="keyword">else</span>{</div><div class="line">            <span class="keyword">this</span>.pstmt.setInt(<span class="number">7</span>,vo.getDept().getDeptno());</div><div class="line">        }</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">8</span>,vo.getEmpno());</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pstmt.executeUpdate() &gt; <span class="number">0</span>;</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>查询单个雇员信息的时候也要进行全部内容的查询。需要进行多表查询，那么在 IEmpDAO 中扩充功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEmpDAO</span> <span class="keyword">extends</span> <span class="title">IDAO</span>&lt;<span class="title">Integer</span>,<span class="title">Emp</span>&gt;</span>{</div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 查询雇员的详细信息，包括雇员对应的领导信息和所在部门的信息</div><div class="line">     *<span class="javadoctag"> @param</span> id 要查询的雇员编号</div><div class="line">     *<span class="javadoctag"> @return</span> 所有的数据以 VO 对象返回，如果没有则返回 null</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Emp <span class="title">findByIdDetails</span>(Integer id) <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 查询雇员的完整信息</div><div class="line">     *<span class="javadoctag"> @return</span> 所有的数据对象以 List 集合返回，如果没有数据集合长度为 0（size == 0）</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 查询错误</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAllDetails</span>() <span class="keyword">throws</span> Exception;</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * 分页进行数据的模糊查询，查询结果以集合的形式返回</div><div class="line">     *<span class="javadoctag"> @param</span> offset 数据行的偏移量</div><div class="line">     *<span class="javadoctag"> @param</span> maxNum 数据行的最大数目</div><div class="line">     *<span class="javadoctag"> @param</span> column 进行模糊查询的数据列</div><div class="line">     *<span class="javadoctag"> @param</span> keyWord 模糊查询的关键字</div><div class="line">     *<span class="javadoctag"> @return</span> 中有数据，则将数据封装为 VO 类对象然后利用 List 集合返回，&lt;br&gt;</div><div class="line">     * 如果没有数据，那么集合的长度为 0（size() == 0，不是 null）&lt;/&gt;</div><div class="line">     *<span class="javadoctag"> @throws</span> Exception SQL 执行异常</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAllSplitDetails</span>(Integer offset,Integer maxNum,String column,String keyWord) <span class="keyword">throws</span> Exception;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>实现细节：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Emp <span class="title">findByIdDetails</span>(Integer id) <span class="keyword">throws</span> Exception {</div><div class="line">        Emp vo = <span class="keyword">null</span>;</div><div class="line">        String sql = <span class="string">"SELECT e.ename,e.job,e.hiredate,e.sal,e.comm, "</span> +</div><div class="line">                <span class="string">"m.empno,m.ename, "</span> +</div><div class="line">                <span class="string">"d.deptno,d.name,d.loc "</span>+</div><div class="line">                <span class="string">"FROM emp e,emp m,dept d "</span> +</div><div class="line">                <span class="string">"WHERE e.mgr=m.empno AND e.dept=d.deptno AND e.empno=?"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">1</span>,id);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            vo = <span class="keyword">new</span> Emp();</div><div class="line">            vo.setEname(rs.getString(<span class="number">1</span>));</div><div class="line">            vo.setJob(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setHiredate(rs.getDate(<span class="number">3</span>));</div><div class="line">            vo.setSal(rs.getDouble(<span class="number">4</span>));</div><div class="line">            vo.setComm(rs.getDouble(<span class="number">5</span>));</div><div class="line">            Emp mgr = <span class="keyword">new</span> Emp();</div><div class="line">            mgr.setEmpno(rs.getInt(<span class="number">6</span>));</div><div class="line">            mgr.setEname(rs.getString(<span class="number">7</span>));</div><div class="line">            vo.setMgr(mgr);</div><div class="line">            Dept dept = <span class="keyword">new</span> Dept();</div><div class="line">            dept.setDeptno(rs.getInt(<span class="number">8</span>));</div><div class="line">            dept.setDname(rs.getString(<span class="number">9</span>));</div><div class="line">            dept.setLoc(rs.getString(<span class="number">10</span>));</div><div class="line">            vo.setDept(dept);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> vo;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAllDetails</span>() <span class="keyword">throws</span> Exception {</div><div class="line">        List&lt;Emp&gt; all = <span class="keyword">new</span> ArrayList&lt;Emp&gt;();</div><div class="line">        String sql = <span class="string">"SELECT e.empno,e.ename,e.job,e.hiredate,e.sal,e.comm, "</span> +</div><div class="line">                <span class="string">"m.empno,m.ename, "</span> +</div><div class="line">                <span class="string">"d.deptno,d.name,d.loc "</span>+</div><div class="line">                <span class="string">"FROM emp e,emp m,dept d "</span> +</div><div class="line">                <span class="string">"WHERE e.mgr=m.empno AND e.dept=d.deptno"</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            Emp vo = <span class="keyword">new</span> Emp();</div><div class="line">            vo.setEmpno(rs.getInt(<span class="number">1</span>));</div><div class="line">            vo.setEname(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setJob(rs.getString(<span class="number">3</span>));</div><div class="line">            vo.setHiredate(rs.getDate(<span class="number">4</span>));</div><div class="line">            vo.setSal(rs.getDouble(<span class="number">5</span>));</div><div class="line">            vo.setComm(rs.getDouble(<span class="number">6</span>));</div><div class="line">            Emp mgr = <span class="keyword">new</span> Emp();</div><div class="line">            mgr.setEmpno(rs.getInt(<span class="number">7</span>));</div><div class="line">            mgr.setEname(rs.getString(<span class="number">8</span>));</div><div class="line">            vo.setMgr(mgr);</div><div class="line">            Dept dept = <span class="keyword">new</span> Dept();</div><div class="line">            dept.setDeptno(rs.getInt(<span class="number">9</span>));</div><div class="line">            dept.setDname(rs.getString(<span class="number">10</span>));</div><div class="line">            dept.setLoc(rs.getString(<span class="number">11</span>));</div><div class="line">            vo.setDept(dept);</div><div class="line">            all.add(vo);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> all;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAllSplitDetails</span>(Integer offset, Integer maxNum, String column, String keyWord) <span class="keyword">throws</span> Exception {</div><div class="line">        List&lt;Emp&gt; all = <span class="keyword">new</span> ArrayList&lt;Emp&gt;();</div><div class="line">        String sql = <span class="string">"SELECT * FROM( "</span> +</div><div class="line">                <span class="string">" SELECT e.empno,e.ename,e.job,e.hiredate,e.sal,e.comm, "</span> +</div><div class="line">                <span class="string">" m.empno mno,m.ename mname,d.deptno dno,d.dname,d.loc "</span>+</div><div class="line">                <span class="string">" FROM emp e,emp m,dept d "</span> +</div><div class="line">                <span class="string">" WHERE e.mgr=m.empno AND e.dept=d.deptno "</span> +</div><div class="line">                <span class="string">" AND e."</span> + column + <span class="string">" LIKE ?) as total "</span> +</div><div class="line">                <span class="string">" LIMIT ?,? "</span>;</div><div class="line">        <span class="keyword">this</span>.pstmt = <span class="keyword">this</span>.conn.prepareStatement(sql);</div><div class="line"></div><div class="line">        <span class="keyword">this</span>.pstmt.setString(<span class="number">1</span>,<span class="string">"%"</span>+keyWord+<span class="string">"%"</span>);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">2</span>,offset);</div><div class="line">        <span class="keyword">this</span>.pstmt.setInt(<span class="number">3</span>,maxNum);</div><div class="line">        ResultSet rs = <span class="keyword">this</span>.pstmt.executeQuery();</div><div class="line">        <span class="keyword">while</span>(rs.next()){</div><div class="line">            Emp vo = <span class="keyword">new</span> Emp();</div><div class="line">            vo.setEmpno(rs.getInt(<span class="number">1</span>));</div><div class="line">            vo.setEname(rs.getString(<span class="number">2</span>));</div><div class="line">            vo.setJob(rs.getString(<span class="number">3</span>));</div><div class="line">            vo.setHiredate(rs.getDate(<span class="number">4</span>));</div><div class="line">            vo.setSal(rs.getDouble(<span class="number">5</span>));</div><div class="line">            vo.setComm(rs.getDouble(<span class="number">6</span>));</div><div class="line">            Emp mgr = <span class="keyword">new</span> Emp();</div><div class="line">            mgr.setEmpno(rs.getInt(<span class="number">7</span>));</div><div class="line">            mgr.setEname(rs.getString(<span class="number">8</span>));</div><div class="line">            vo.setMgr(mgr);</div><div class="line">            Dept dept = <span class="keyword">new</span> Dept();</div><div class="line">            dept.setDeptno(rs.getInt(<span class="number">9</span>));</div><div class="line">            dept.setDname(rs.getString(<span class="number">10</span>));</div><div class="line">            dept.setLoc(rs.getString(<span class="number">11</span>));</div><div class="line">            vo.setDept(dept);</div><div class="line">            all.add(vo);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> all;</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>修改服务层接口，IEmpService：这里为了简单，只实现了一个方法接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">listDetails</span>(<span class="keyword">int</span> offset,<span class="keyword">int</span> maxNum,String column,String keyWord) <span class="keyword">throws</span> Exception;</div></pre></td></tr></table></figure>

<p>修改服务层实现 EmpServiceImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">listDetails</span>(<span class="keyword">int</span> offset, <span class="keyword">int</span> maxNum, String column, String keyWord) <span class="keyword">throws</span> Exception {</div><div class="line">        <span class="keyword">try</span>{</div><div class="line">            Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">            map.put(<span class="string">"allEmps"</span>,DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).findAllSplitDetails(offset,maxNum,column,keyWord));</div><div class="line">            map.put(<span class="string">"empCount"</span>,DAOFactory.getIEmpDAOInstance(<span class="keyword">this</span>.dbc.getConnection()).getAllCount(column,keyWord));</div><div class="line">            <span class="keyword">return</span> map;</div><div class="line">        }<span class="keyword">catch</span>(Exception e){</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        }<span class="keyword">finally</span>{</div><div class="line">            <span class="keyword">this</span>.dbc.close();</div><div class="line">        }</div><div class="line">    }</div></pre></td></tr></table></figure>

</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/Java/">Java</a></li></ul></footer></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 JiaojiaoFu</div></footer><script src="/js/scroller.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>
</body></html>